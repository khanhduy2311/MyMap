doctype html
html(lang="vi")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    //- Pug sẽ tự động dùng biến 'title' được truyền từ res.render
    title= title
    //- Thêm các file CSS của bạn ở đây. Ví dụ:
    //- link(rel="stylesheet", href="/css/style.css")
    style.
      /* Thêm style cho trang mindmap của bạn */
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        line-height: 1.6;
        background-color: #f9f9f9;
        color: #333;
        margin: 0;
        padding: 20px;
      }
      #mindmap-container {
        max-width: 900px;
        margin: 20px auto;
        background-color: #fff;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      }
      h1, h2 {
        color: #2c3e50;
      }
      pre {
        background-color: #f4f4f4;
        padding: 15px;
        border-radius: 5px;
        white-space: pre-wrap; /* Để xuống dòng tự động */
        word-wrap: break-word;
        font-size: 0.9em;
        border: 1px solid #ddd;
      }

  body
    //- Include header của bạn nếu có (ví dụ: include ../partials/header.pug)

    #mindmap-container
      h1 Kết quả tóm tắt - Sơ đồ tư duy
      div#render-area
        p Đang tải dữ liệu...

    script.
      //- Toàn bộ JavaScript này sẽ được đưa thẳng vào file HTML đầu ra
      document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById('render-area');
        
        // Lấy dữ liệu đã được lưu từ trang upload
        const mindmapJSON = localStorage.getItem('mindmapData');
        
        if (mindmapJSON) {
          try {
            const mindmapData = JSON.parse(mindmapJSON);
            
            // Xóa dữ liệu khỏi localStorage để tránh hiển thị lại khi refresh
            localStorage.removeItem('mindmapData');
            
            // Hiển thị dữ liệu (bạn có thể thay bằng thư viện vẽ mindmap ở đây)
            container.innerHTML = `
              <h2>${mindmapData.mainTopic || 'Không có chủ đề chính'}</h2>
              <p><strong>Tóm tắt chung:</strong> ${mindmapData.summary || 'Không có tóm tắt.'}</p>
              <h3>Chi tiết các phần:</h3>
              <pre>${JSON.stringify(mindmapData.subTopics, null, 2)}</pre>
            `;

          } catch (e) {
            container.innerHTML = '<p style="color: red;">Lỗi: Dữ liệu mindmap không hợp lệ.</p>';
            console.error("Lỗi parse JSON:", e);
          }
        } else {
          container.innerHTML = '<p style="color: orange;">Không tìm thấy dữ liệu mindmap. Vui lòng <a href="/document/page">quay lại</a> và tải tài liệu lên.</p>';
        }
      });